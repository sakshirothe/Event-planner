<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI University Event Planner - Cool Tone</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        /* Custom styles for Inter font and general body */
        body {
            font-family: 'Inter', sans-serif;
            /* Cool Tone Theme: Blue/Green gradient with subtle glow */
            background: radial-gradient(circle at center, #0a1a2a 0%, #05101a 50%, #000a10 100%);
            color: #e0e0e0; /* Lighter text for dark background */
            min-height: 100vh;
            display: flex;
            flex-direction: column; /* Corrected typo */
            overflow-x: hidden; /* Prevent horizontal scroll from animations */
        }

        /* Glitch Effect for text - Adjusted for cool tones */
        .glitch-text {
            animation: glitch 1.5s infinite;
            position: relative;
            display: inline-block;
        }

        @keyframes glitch {
            0% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(-2px, -2px); }
            60% { transform: translate(2px, 2px); }
            80% { transform: translate(2px, -2px); }
            100% { transform: translate(0); }
        }

        /* Pulsating Glow for elements - Adjusted for cool tones */
        .pulse-glow {
            animation: pulseGlow 2s infinite alternate;
        }

        @keyframes pulseGlow {
            0% { box-shadow: 0 0 5px rgba(0, 150, 255, 0.4), 0 0 10px rgba(0, 255, 150, 0.2); }
            100% { box-shadow: 0 0 15px rgba(0, 150, 255, 0.8), 0 0 25px rgba(0, 255, 150, 0.4); }
        }

        /* Custom styling for tooltips - Adjusted for cool tones */
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 180px;
            background-color: #002233; /* Darker, cool tooltip background */
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px 0;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -90px;
            opacity: 0;
            transition: opacity 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.4);
            border: 1px solid #00aaff; /* Blue border */
        }

        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: #002233 transparent transparent transparent;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        /* Loading spinner animation - Adjusted for cool tones */
        .spinner {
            border: 4px solid rgba(0, 150, 255, 0.2);
            border-left-color: #00aaff; /* Blue spinner */
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Modal specific styles - Adjusted for cool tones */
        .modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.8); /* Even darker overlay */
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s ease, visibility 0.4s ease;
        }

        .modal.show {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: #05101a; /* Dark, cool modal background */
            color: #e0e0e0;
            margin: auto;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0, 150, 255, 0.4), 0 0 30px rgba(0, 255, 150, 0.2); /* Blue/green glow */
            width: 90%;
            max-width: 500px;
            text-align: center;
            transform: scale(0.8); /* Start smaller */
            transition: transform 0.4s ease;
            border: 2px solid #00aaff; /* Blue border */
        }

        .modal.show .modal-content {
            transform: scale(1); /* Scale up */
        }

        .close-button {
            color: #00aaff; /* Blue close button */
            float: right;
            font-size: 32px;
            font-weight: bold;
            line-height: 1;
        }

        .close-button:hover,
        .close-button:focus {
            color: #55ccff;
            text-decoration: none;
            cursor: pointer;
        }

        /* Enhanced button styles - Adjusted for cool tones */
        .btn-primary {
            background: linear-gradient(45deg, #003366, #0055aa); /* Dark blue gradient */
            color: #e0e0e0; /* Lighter text */
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            z-index: 1;
            border: 1px solid #00aaff; /* Blue border */
        }
        .btn-primary:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 6px 12px rgba(0, 150, 255, 0.4), 0 0 15px rgba(0, 255, 150, 0.2); /* Blue/green glow on hover */
            background: linear-gradient(45deg, #0055aa, #003366); /* Invert gradient on hover */
        }
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.1); /* Subtle shimmer */
            transform: skewX(-30deg);
            transition: all 0.5s ease;
            z-index: -1;
        }
        .btn-primary:hover::before {
            left: 100%;
        }

        /* Specific styles for action buttons - adjusted for theme */
        #downloadPdfBtn {
            background: linear-gradient(45deg, #004d40, #00806a); /* Dark teal gradient */
            border-color: #00ccaa;
        }
        #downloadPdfBtn:hover {
            background: linear-gradient(45deg, #00806a, #004d40);
        }

        #editPlanBtn {
            background: linear-gradient(45deg, #4d4d00, #808000); /* Dark yellow/green gradient - keeping for contrast */
            border-color: #ffff00;
        }
        #editPlanBtn:hover {
            background: linear-gradient(45deg, #808000, #4d4d00);
        }

        #startNewBtn {
            background: linear-gradient(45deg, #660000, #990000); /* Darker red gradient - keeping for danger/reset contrast */
            border-color: #ff0000;
        }
        #startNewBtn:hover {
            background: linear-gradient(45deg, #990000, #660000);
        }

        /* Card enhancements - adjusted for theme */
        .card {
            background-color: rgba(5, 10, 26, 0.8); /* Semi-transparent dark blue */
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 150, 255, 0.2), 0 0 20px rgba(0, 255, 150, 0.1); /* Subtle blue/green glow */
            padding: 24px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid #003366; /* Dark blue border */
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 150, 255, 0.4), 0 0 30px rgba(0, 255, 150, 0.2); /* More pronounced glow */
        }

        /* Input field focus glow - adjusted for theme */
        input:focus, select:focus, textarea:focus {
            border-color: #00aaff; /* Blue border on focus */
            box-shadow: 0 0 0 3px rgba(0, 150, 255, 0.4); /* Blue glow */
            outline: none;
        }

        /* Header gradient - adjusted for theme */
        header {
            background: linear-gradient(90deg, #001122, #002244, #003366); /* Darker, more ominous blue gradient */
            border-bottom: 2px solid #00aaff; /* Blue border */
        }

        /* Icon colors */
        .text-blue-500 {
            color: #00ccff; /* Bright blue for icons */
        }
        .text-gray-700 {
            color: #c0c0c0; /* Lighter grey for labels */
        }
        .text-gray-800 {
            color: #e0e0e0; /* Lighter grey for main headings */
        }
        .text-gray-900 {
            color: #ffffff; /* White for important text */
        }
        .text-gray-600 {
            color: #a0a0a0; /* Medium grey */
        }
        .text-gray-500 {
            color: #808080; /* Darker grey for tooltips info icon */
        }
        .text-blue-600 {
            color: #00ccff; /* Bright blue for hashtags */
        }
        .text-sm.font-light {
            color: #e0e0e0; /* Table text */
        }
        .bg-gray-100 {
            background-color: #002233; /* Darker table header */
            color: #e0e0e0;
        }
        .border-gray-200 {
            border-color: #003366; /* Darker table borders */
        }
        .hover\:bg-gray-50:hover {
            background-color: #0a1a2a; /* Darker table row hover */
        }
        .bg-gray-50 {
            background-color: #05101a; /* Darker pre background */
        }


        /* Section entry animation */
        .fade-in-up {
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.6s ease-out forwards;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* New animations */
        .slide-in-left {
            opacity: 0;
            transform: translateX(-50px);
            animation: slideInLeft 0.7s ease-out forwards;
        }

        @keyframes slideInLeft {
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .slide-in-right {
            opacity: 0;
            transform: translateX(50px);
            animation: slideInRight 0.7s ease-out forwards;
        }

        @keyframes slideInRight {
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .scale-in {
            opacity: 0;
            transform: scale(0.8);
            animation: scaleIn 0.5s ease-out forwards;
        }

        @keyframes scaleIn {
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">
    <header class="text-white p-4 shadow-md sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold glitch-text">AI University Event Planner</h1>
            <nav>
                </nav>
        </div>
    </header>

    <main class="flex-grow container mx-auto p-4 md:p-8">
        <div class="rounded-lg shadow-xl p-6 md:p-8 mb-8 card pulse-glow">
            <h2 class="text-3xl font-extrabold text-center mb-6 glitch-text">Plan Your University Event</h2>
            <form id="eventForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="relative">
                    <label for="eventType" class="block text-sm font-semibold mb-2">
                        <i class="fas fa-calendar-alt mr-2"></i>Event Type
                    </label>
                    <select id="eventType" name="eventType" required
                            class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 transition duration-200 bg-gray-900 text-white">
                        <option value="">Select Event Type</option>
                        <option value="Seminar">Seminar</option>
                        <option value="Fest">Fest</option>
                        <option value="Hackathon">Hackathon</option>
                        <option value="Workshop">Workshop</option>
                        <option value="Conference">Conference</option>
                        <option value="Cultural Event">Cultural Event</option>
                        <option value="Sports Event">Sports Event</option>
                        <option value="Webinar">Webinar</option>
                        <option value="Exhibition">Exhibition</option>
                    </select>
                </div>

                <div class="relative">
                    <label for="audience" class="block text-sm font-semibold mb-2">
                        <i class="fas fa-users mr-2"></i>Audience
                    </label>
                    <input type="text" id="audience" name="audience" placeholder="e.g., All University Students, Engineering Freshmen" required
                           class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 transition duration-200 bg-gray-900 text-white">
                </div>

                <div class="relative">
                    <label for="theme" class="block text-sm font-semibold mb-2">
                        <i class="fas fa-palette mr-2"></i>Theme
                    </label>
                    <input type="text" id="theme" name="theme" placeholder="e.g., Future of AI, Sustainable Living" required
                           class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 transition duration-200 bg-gray-900 text-white">
                </div>

                <div class="relative">
                    <label for="eventDate" class="block text-sm font-semibold mb-2">
                        <i class="fas fa-calendar-day mr-2"></i>Date
                    </label>
                    <input type="date" id="eventDate" name="eventDate" required
                           class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 transition duration-200 bg-gray-900 text-white">
                </div>

                <div class="relative">
                    <label for="duration" class="block text-sm font-semibold mb-2">
                        <i class="fas fa-hourglass-half mr-2"></i>Duration (Days)
                    </label>
                    <input type="number" id="duration" name="duration" min="0.5" step="0.5" placeholder="e.g., 1, 0.5" required
                           class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 transition duration-200 bg-gray-900 text-white">
                </div>

                <div class="relative">
                    <label for="mode" class="block text-sm font-semibold mb-2">
                        <i class="fas fa-globe mr-2"></i>Mode
                    </label>
                    <select id="mode" name="mode" required
                            class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 transition duration-200 bg-gray-900 text-white">
                        <option value="">Select Mode</option>
                        <option value="Online">Online</option>
                        <option value="Offline">Offline</option>
                        <option value="Hybrid">Hybrid</option>
                    </select>
                </div>

                <div id="venueGroup" class="relative hidden">
                    <label for="venue" class="block text-sm font-semibold mb-2">
                        <i class="fas fa-map-marker-alt mr-2"></i>Venue
                        <span class="tooltip text-xs ml-1">
                            <i class="fas fa-info-circle"></i>
                            <span class="tooltiptext">Click to autofill nearest venues based on your location.</span>
                        </span>
                    </label>
                    <input type="text" id="venue" name="venue" placeholder="e.g., University Auditorium, City Convention Center"
                           class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 transition duration-200 bg-gray-900 text-white">
                    <button type="button" id="autofillVenueBtn" class="absolute right-2 top-1/2 -translate-y-1/2 p-2 rounded-full bg-blue-700 text-white hover:bg-blue-800 focus:outline-none focus:ring-2 focus:ring-blue-500 transition duration-200">
                        <i class="fas fa-location-crosshairs"></i>
                    </button>
                </div>

                <div class="relative">
                    <label for="budgetLimit" class="block text-sm font-semibold mb-2">
                        <i class="fas fa-money-bill-wave mr-2"></i>Budget Limit (INR)
                        <span class="tooltip text-xs ml-1">
                            <i class="fas fa-info-circle"></i>
                            <span class="tooltiptext">Estimated budget in Indian Rupees.</span>
                        </span>
                    </label>
                    <input type="number" id="budgetLimit" name="budgetLimit" min="0" placeholder="e.g., 50000" required
                           class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 transition duration-200 bg-gray-900 text-white">
                </div>

                <div class="relative md:col-span-2">
                    <label for="customCommittees" class="block text-sm font-semibold mb-2">
                        <i class="fas fa-users mr-2"></i>Custom Committees (Optional)
                        <span class="tooltip text-xs ml-1">
                            <i class="fas fa-info-circle"></i>
                            <span class="tooltiptext">Enter comma-separated custom committee names. Example: "Volunteer Recruitment, Sponsor Relations"</span>
                        </span>
                    </label>
                    <input type="text" id="customCommittees" name="customCommittees" placeholder="e.g., Volunteer Recruitment, Sponsor Relations"
                           class="w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 transition duration-200 bg-gray-900 text-white">
                </div>


                <div class="md:col-span-2 flex justify-center mt-6">
                    <button type="submit"
                            class="btn-primary font-bold py-3 px-8 rounded-full shadow-lg focus:outline-none focus:ring-4 focus:ring-blue-300 scale-in">
                        <i class="fas fa-magic mr-2"></i>Generate Plan
                    </button>
                </div>
            </form>
        </div>

        <div id="loadingSpinner" class="hidden flex flex-col justify-center items-center py-10">
            <div class="spinner mb-4 pulse-glow"></div>
            <p class="text-lg text-gray-600 glitch-text">Generating your event plan...</p>
            <p class="text-sm text-gray-500 mt-2">This might take a moment as our AI crafts the perfect plan!</p>
        </div>

        <div id="planOutput" class="hidden">
            <h2 class="text-3xl font-extrabold text-center mb-8 fade-in-up glitch-text">Your Event Plan</h2>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <div class="card fade-in-up" style="animation-delay: 0.1s;">
                    <h3 class="text-2xl font-bold mb-4 flex items-center"><i class="fas fa-heading mr-3"></i>Event Title</h3>
                    <p id="outputTitle" class="text-xl font-semibold"></p>
                </div>
                <div class="card fade-in-up" style="animation-delay: 0.2s;">
                    <h3 class="text-2xl font-bold mb-4 flex items-center"><i class="fas fa-file-alt mr-3"></i>Event Description</h3>
                    <p id="outputDescription" class="leading-relaxed"></p>
                </div>
            </div>

            <div id="resourceContent" class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <div class="card slide-in-left" style="animation-delay: 0.3s;">
                    <h3 class="text-2xl font-bold mb-4 flex items-center"><i class="fas fa-door-open mr-3"></i>Suggested Venues/Rooms</h3>
                    <ul id="outputRooms" class="list-disc list-inside space-y-2"></ul>
                </div>
                <div class="card slide-in-right" style="animation-delay: 0.4s;">
                    <h3 class="text-2xl font-bold mb-4 flex items-center"><i class="fas fa-video mr-3"></i>Suggested Equipment</h3>
                    <ul id="outputEquipment" class="list-disc list-inside space-y-2"></ul>
                </div>
            </div>

            <div id="speakerContent" class="grid grid-cols-1 gap-6 mb-8">
                <div class="card fade-in-up" style="animation-delay: 0.5s;">
                    <h3 class="text-2xl font-bold mb-4 flex items-center"><i class="fas fa-microphone-alt mr-3"></i>Suggested Speakers/Guests</h3>
                    <ul id="outputSpeakers" class="list-disc list-inside space-y-2"></ul>
                </div>
            </div>

            <div id="sportsContent" class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8 hidden">
                <div class="card slide-in-left" style="animation-delay: 0.6s;">
                    <h3 class="text-2xl font-bold mb-4 flex items-center"><i class="fas fa-trophy mr-3"></i>Sports Seminar Name Ideas</h3>
                    <ul id="outputSportsNames" class="list-disc list-inside space-y-2"></ul>
                </div>
                <div class="card slide-in-right" style="animation-delay: 0.7s;">
                    <h3 class="text-2xl font-bold mb-4 flex items-center"><i class="fas fa-quote-left mr-3"></i>Motivational Sports Quotes</h3>
                    <ul id="outputSportsQuotes" class="list-disc list-inside space-y-2"></ul>
                </div>
            </div>

            <div class="card mb-8 fade-in-up" style="animation-delay: 0.8s;">
                <h3 class="text-2xl font-bold mb-4 flex items-center"><i class="fas fa-clipboard-list mr-3"></i>Sample Schedule</h3>
                <div class="overflow-x-auto">
                    <table class="min-w-full border rounded-lg">
                        <thead>
                            <tr class="uppercase text-sm leading-normal bg-gray-100">
                                <th class="py-3 px-6 text-left">Time</th>
                                <th class="py-3 px-6 text-left">Activity</th>
                                <th class="py-3 px-6 text-left">Speaker/Performer</th>
                            </tr>
                        </thead>
                        <tbody id="outputSchedule" class="text-sm font-light">
                            </tbody>
                    </table>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <div class="card slide-in-left" style="animation-delay: 0.9s;">
                    <h3 class="text-2xl font-bold mb-4 flex items-center"><i class="fas fa-paint-brush mr-3"></i>Poster Design Ideas</h3>
                    <ul id="outputPosterIdeas" class="list-disc list-inside space-y-2"></ul>
                </div>
                <div class="card slide-in-right" style="animation-delay: 1.0s;">
                    <h3 class="text-2xl font-bold mb-4 flex items-center"><i class="fas fa-share-alt mr-3"></i>Social Media & Marketing Content</h3>
                    <h4 class="font-semibold mt-2 text-gray-700">Caption:</h4>
                    <p id="outputSocialMedia" class="leading-relaxed mb-2"></p>
                    <h4 class="font-semibold text-gray-700">Hashtags:</h4>
                    <p id="outputHashtags" class="font-medium mb-2"></p>
                    <h4 class="font-semibold text-gray-700">Email Draft:</h4>
                    <pre id="outputEmailDraft" class="p-3 rounded-lg text-sm whitespace-pre-wrap font-mono leading-relaxed border bg-gray-50 mb-2"></pre>
                    <h4 class="font-semibold text-gray-700">Press Release Snippet:</h4>
                    <pre id="outputPressRelease" class="p-3 rounded-lg text-sm whitespace-pre-wrap font-mono leading-relaxed border bg-gray-50"></pre>
                </div>
            </div>

            <div class="grid grid-cols-1 gap-6 mb-8">
                <div class="card fade-in-up" style="animation-delay: 1.1s;">
                    <h3 class="text-2xl font-bold mb-4 flex items-center"><i class="fas fa-users-cog mr-3"></i>Required Committees & Assigned Staff</h3>
                    <ul id="outputCommittees" class="list-disc list-inside space-y-2"></ul>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <div class="card slide-in-left" style="animation-delay: 1.2s;">
                    <h3 class="text-2xl font-bold mb-4 flex items-center"><i class="fas fa-chart-pie mr-3"></i>Budget Breakdown</h3>
                    <ul id="outputBudget" class="list-disc list-inside space-y-2"></ul>
                </div>
                <div class="card slide-in-right" style="animation-delay: 1.3s;">
                    <h3 class="text-2xl font-bold mb-4 flex items-center"><i class="fas fa-lightbulb mr-3"></i>Decoration Suggestions</h3>
                    <ul id="outputDecorations" class="list-disc list-inside space-y-2"></ul>
                </div>
            </div>

            <div class="card mb-8 fade-in-up" style="animation-delay: 1.4s;">
                <h3 class="text-2xl font-bold mb-4 flex items-center"><i class="fas fa-tasks mr-3"></i>Event Planning Checklist</h3>
                <ul id="outputChecklist" class="list-disc list-inside space-y-2"></ul>
            </div>

            <div class="card mb-8 fade-in-up" style="animation-delay: 1.5s;">
                <h3 class="text-2xl font-bold mb-4 flex items-center"><i class="fas fa-exclamation-triangle mr-3"></i>Contingency Planning</h3>
                <p id="outputContingency" class="leading-relaxed"></p>
            </div>

            <div class="card mb-8 fade-in-up" style="animation-delay: 1.6s;">
                <h3 class="text-2xl font-bold mb-4 flex items-center"><i class="fas fa-envelope-open-text mr-3"></i>Letter of Permission</h3>
                <pre id="outputLetter" class="p-4 rounded-lg text-sm whitespace-pre-wrap font-mono leading-relaxed border bg-gray-50"></pre>
            </div>


            <div class="flex flex-col sm:flex-row justify-center gap-4 mt-8 fade-in-up" style="animation-delay: 1.7s;">
                <button id="downloadPdfBtn"
                        class="btn-primary font-bold py-3 px-6 rounded-full shadow-lg focus:outline-none focus:ring-4 focus:ring-green-300 scale-in" style="animation-delay: 1.8s;">
                    <i class="fas fa-download mr-2"></i>Download Full Plan (PDF)
                </button>
                <button id="editPlanBtn"
                        class="btn-primary font-bold py-3 px-6 rounded-full shadow-lg focus:outline-none focus:ring-4 focus:ring-yellow-300 scale-in" style="animation-delay: 1.9s;">
                    <i class="fas fa-edit mr-2"></i>Edit Plan
                </button>
                <button id="startNewBtn"
                        class="btn-primary font-bold py-3 px-6 rounded-full shadow-lg focus:outline-none focus:ring-4 focus:ring-red-300 scale-in" style="animation-delay: 2.0s;">
                    <i class="fas fa-plus mr-2"></i>Start New
                </button>
            </div>
        </div>
    </main>

    <div id="customModal" class="modal">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <p id="modalMessage" class="text-lg mb-4"></p>
            <div id="modalActions" class="flex justify-center gap-4">
                </div>
        </div>
    </div>

    <script>
        // Get DOM elements
        const eventForm = document.getElementById('eventForm');
        const modeSelect = document.getElementById('mode');
        const venueGroup = document.getElementById('venueGroup');
        const venueInput = document.getElementById('venue');
        const autofillVenueBtn = document.getElementById('autofillVenueBtn');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const planOutput = document.getElementById('planOutput');
        const customCommitteesInput = document.getElementById('customCommittees');


        const outputTitle = document.getElementById('outputTitle');
        const outputDescription = document.getElementById('outputDescription');
        const outputSchedule = document.getElementById('outputSchedule');
        const outputPosterIdeas = document.getElementById('outputPosterIdeas');
        const outputSocialMedia = document.getElementById('outputSocialMedia');
        const outputHashtags = document.getElementById('outputHashtags');
        const outputCommittees = document.getElementById('outputCommittees');
        const outputBudget = document.getElementById('outputBudget');
        const outputLetter = document.getElementById('outputLetter');
        const outputDecorations = document.getElementById('outputDecorations');
        const outputChecklist = document.getElementById('outputChecklist');
        const outputContingency = document.getElementById('outputContingency');
        const outputEmailDraft = document.getElementById('outputEmailDraft');
        const outputPressRelease = document.getElementById('outputPressRelease');

        // New elements for sports suggestions
        const sportsContentDiv = document.getElementById('sportsContent');
        const outputSportsNames = document.getElementById('outputSportsNames');
        const outputSportsQuotes = document.getElementById('outputSportsQuotes');

        // New elements for resources and speakers
        const resourceContentDiv = document.getElementById('resourceContent');
        const outputRooms = document.getElementById('outputRooms');
        const outputEquipment = document.getElementById('outputEquipment');
        const speakerContentDiv = document.getElementById('speakerContent');
        const outputSpeakers = document.getElementById('outputSpeakers');


        const downloadPdfBtn = document.getElementById('downloadPdfBtn');
        const editPlanBtn = document.getElementById('editPlanBtn');
        const startNewBtn = document.getElementById('startNewBtn');

        // Modal elements
        const customModal = document.getElementById('customModal');
        const modalMessage = document.getElementById('modalMessage');
        const modalActions = document.getElementById('modalActions');
        const closeModalButton = customModal.querySelector('.close-button');

        // Global variable to store the generated plan for PDF generation
        let currentPlanData = {};

        // Staff Data - Updated with skills and maxAssignments
        const staffData = [
            { name: "Prof. Pravin Uttam Chokakkar", designation: "Professor", department: "C.S.E", skills: ["AI", "Machine Learning", "Data Science", "Research"], maxAssignments: 2 },
            { name: "Prof. Gaikwad Aditya Vikas", designation: "Professor", department: "C.S.E", skills: ["Web Development", "Database Management", "Project Management"], maxAssignments: 3 },
            { name: "Prof. Kinhago Joshi", designation: "Professor", department: "C.S.E", skills: ["Cybersecurity", "Networking", "Event Logistics"], maxAssignments: 2 },
            { name: "Dr. Ajaj Singh", designation: "Professor", department: "C.S.E", skills: ["Cloud Computing", "Software Engineering", "Public Speaking"], maxAssignments: 2 },
            { name: "Prof. Srirang Batra", designation: "Professor", department: "C.S.E", skills: ["Algorithms", "Data Structures", "Academic Coordination"], maxAssignments: 3 },
            { name: "Prof. Devesh Nandan Upadhyay", designation: "Professor", department: "C.S.E", skills: ["DevOps", "System Administration", "Technical Support"], maxAssignments: 2 },
            { name: "Prof. Vikas Kumar", designation: "Professor", department: "C.S.E", skills: ["Mobile Development", "UI/UX Design", "Student Mentoring"], maxAssignments: 3 },
            { name: "Prof. Raghvendra Singh Kuwar", designation: "Professor", department: "C.S.E", skills: ["Computer Graphics", "Game Development", "Creative Design"], maxAssignments: 2 },
            { name: "Dr. Nina Ramasahoo Chopde", designation: "Professor", department: "C.S.E", skills: ["Natural Language Processing", "Robotics", "Research"], maxAssignments: 2 },
            { name: "Prof. Utkarsh Nilgal Madanshu", designation: "Professor", department: "C.S.E", skills: ["Big Data Analytics", "Distributed Systems", "Logistics"], maxAssignments: 3 },
            { name: "Prof. Nachiketa Subodh Salun", designation: "Professor", department: "CS", skills: ["Operating Systems", "Computer Architecture", "IT Infrastructure"], maxAssignments: 2 },
            { name: "Dr. Prashant Shivraj Dhami", designation: "Professor", department: "CS", skills: ["Theory of Computation", "Compiler Design", "Curriculum Development"], maxAssignments: 2 },
            { name: "Dr. Muskan Agrawal", designation: "Professor", department: "CS", skills: ["Image Processing", "Computer Vision", "Photography"], maxAssignments: 2 },
            { name: "Dr. Aparupa Chakraborty", designation: "Professor", department: "AI&DS", skills: ["Deep Learning", "Data Visualization", "Statistical Analysis"], maxAssignments: 2 },
            { name: "Dr. Ankur Jain", designation: "Professor", department: "AI&DS", skills: ["Business Intelligence", "Predictive Modeling", "Marketing"], maxAssignments: 3 },
            { name: "Dr. Tanay Renu Ghosh", designation: "Professor", department: "AI&DS", skills: ["Data Warehousing", "ETL Processes", "Sponsorship"], maxAssignments: 2 },
            { name: "Prof. Dhruvraj Vitthalrao Pathak", designation: "Professor", department: "AI&ML", skills: ["Neural Networks", "Reinforcement Learning", "Technical Writing"], maxAssignments: 2 },
            { name: "Prof. Soundharya Goyen", designation: "Professor", department: "AI&ML", skills: ["Applied Machine Learning", "Model Deployment", "Event Coordination"], maxAssignments: 3 },
            { name: "Prof. Sonali Lalu", designation: "Professor", department: "AI&ML", skills: ["Ethical AI", "AI in Healthcare", "Public Relations"], maxAssignments: 2 },
            { name: "Prof. Kajal Hardal Khobragade", designation: "Professor", department: "AI&ML", skills: ["AI for Robotics", "Computer Vision", "Volunteer Management"], maxAssignments: 2 },
            { name: "Prof. Jai Rastogi", designation: "Professor", department: "AI&ML", skills: ["AI in Finance", "Algorithmic Trading", "Budgeting"], maxAssignments: 3 },
            { name: "Prof. Aujwal Shaikh", designation: "Professor", department: "AI&ML", skills: ["AI Ethics", "Legal Aspects of AI", "Documentation"], maxAssignments: 2 },
            { name: "Prof. Nitin Vilasrao Sanjay", designation: "Professor", department: "BBA", skills: ["Marketing Strategy", "Brand Management", "Promotions"], maxAssignments: 3 },
            { name: "Prof. Jadhav Harshada Rajendra", designation: "Professor", department: "BBA", skills: ["Human Resources", "Organizational Behavior", "Guest Relations"], maxAssignments: 2 },
            { name: "Prof. Devendra Dattatray Kote", designation: "Professor", department: "BBA", skills: ["Financial Management", "Event Budgeting", "Vendor Management"], maxAssignments: 2 },
            { name: "Dr. Kulkarni K", designation: "Professor", department: "BBA", skills: ["Supply Chain Management", "Logistics", "Operations"], maxAssignments: 3 },
            { name: "Prof. Jayheri Jayraj Bhabu", designation: "Professor", department: "BBA", skills: ["Entrepreneurship", "Business Development", "Sponsorship Acquisition"], maxAssignments: 2 },
            { name: "Dr. Eswaran Karunahakati", designation: "Professor", department: "MBA", skills: ["Strategic Planning", "Leadership", "Crisis Management"], maxAssignments: 2 },
            { name: "Prof. Rajeswari Mahakali", designation: "Professor", department: "MBA", skills: ["International Business", "Cross-cultural Communication", "Protocol Management"], maxAssignments: 3 },
            { name: "Prof. Nikita Wahi", designation: "Professor", department: "B.COM", skills: ["Accounting", "Financial Reporting", "Audit"], maxAssignments: 2 },
            { name: "Prof. Rohan Sharma", designation: "Assistant Professor", department: "Mechanical", skills: ["CAD Design", "Robotics", "Workshop Coordination"], maxAssignments: 3 },
            { name: "Prof. Priya Singh", designation: "Assistant Professor", department: "Civil", skills: ["Structural Analysis", "Sustainability", "Infrastructure Planning"], maxAssignments: 2 },
            { name: "Dr. Suresh Kumar", designation: "Professor", department: "Electrical", skills: ["Power Systems", "Electronics", "Technical Exhibitions"], maxAssignments: 2 },
            { name: "Ms. Anjali Verma", designation: "Admin Staff", department: "Administration", skills: ["Logistics", "Record Keeping", "Communication"], maxAssignments: 4 },
            { name: "Mr. Deepak Patil", designation: "Technical Staff", department: "IT Support", skills: ["Networking", "Audio-Visual", "Troubleshooting"], maxAssignments: 4 },
            { name: "Ms. Kavita Rao", designation: "Event Coordinator", department: "Student Affairs", skills: ["Event Management", "Student Engagement", "Public Relations"], maxAssignments: 3 },
            { name: "Mr. Alok Gupta", designation: "Librarian", department: "Library", skills: ["Information Management", "Research Support", "Documentation"], maxAssignments: 2 },
            { name: "Ms. Sanjana Desai", designation: "Accounts Officer", department: "Finance", skills: ["Budgeting", "Expense Tracking", "Financial Reporting"], maxAssignments: 3 },
            { name: "Mr. Vivek Chauhan", designation: "Security Head", department: "Security", skills: ["Crowd Management", "Emergency Response", "Safety Protocols"], maxAssignments: 2 },
            { name: "Ms. Shweta Sharma", designation: "Marketing Executive", department: "Marketing", skills: ["Digital Marketing", "Content Creation", "Social Media"], maxAssignments: 3 },
            { name: "Mr. Rajeev Malhotra", designation: "Sports Officer", department: "Sports", skills: ["Sports Coordination", "Team Management", "Fair Play"], maxAssignments: 2 },
            { name: "Ms. Geeta Devi", designation: "Catering Manager", department: "Food Services", skills: ["Menu Planning", "Hygiene Standards", "Logistics"], maxAssignments: 3 },
        ];

        // Resource Data
        const availableRooms = [
            { name: "University Auditorium", capacity: 1000, features: ["Stage", "Projector", "Sound System", "Green Room"] },
            { name: "Main Conference Hall (Block A)", capacity: 300, features: ["Projector", "Sound System", "Breakout Rooms", "Video Conferencing"] },
            { name: "Seminar Hall 1 (Library Building)", capacity: 150, features: ["Projector", "Sound System", "Whiteboard"] },
            { name: "Computer Lab 301", capacity: 50, features: ["Computers", "Projector", "Internet Access"] },
            { name: "Innovation Hub Workshop Room", capacity: 40, features: ["Interactive Display", "Whiteboard", "Movable Furniture"] },
            { name: "Outdoor Sports Ground", capacity: 5000, features: ["Running Track", "Football Field", "Bleachers"] },
            { name: "Indoor Sports Complex", capacity: 1500, features: ["Basketball Court", "Badminton Courts", "Changing Rooms"] },
            { name: "Cultural Plaza", capacity: 2000, features: ["Open Stage", "Seating Area", "Food Stalls Allowed"] },
        ];

        const availableEquipment = [
            { name: "High-Lumen Projector", type: "AV", quantity: 5 },
            { name: "Wireless Microphone Set", type: "Audio", quantity: 10 },
            { name: "Professional Sound System", type: "Audio", quantity: 2 },
            { name: "Laptop (Core i7, 16GB RAM)", type: "Computing", quantity: 20 },
            { name: "VR Headsets", type: "Specialized", quantity: 5 },
            { name: "3D Printers", type: "Specialized", quantity: 3 },
            { name: "Video Camera (4K)", type: "AV", quantity: 3 },
            { name: "Event Banner Printing Machine", type: "Marketing", quantity: 1 },
            { name: "First Aid Kits", type: "Safety", quantity: 15 },
            { name: "Walkie-Talkies", type: "Communication", quantity: 20 },
            { name: "Portable Stage Units", type: "Logistics", quantity: 4 },
        ];

        // Speaker Database (Mock)
        const speakerDatabase = [
            { name: "Dr. Anya Sharma", expertise: ["AI Ethics", "Sustainable Tech", "Future of Education"], availability: "flexible" },
            { name: "Mr. Vikram Patel", expertise: ["Blockchain", "Fintech", "Startup Ecosystem"], availability: "weekends" },
            { name: "Prof. Lena Khan", expertise: ["Climate Change", "Environmental Policy", "Renewable Energy"], availability: "weekdays" },
            { name: "Ms. Zara Singh", expertise: ["Digital Marketing", "Brand Building", "Social Media Strategy"], availability: "flexible" },
            { name: "Coach Rahul Mehta", expertise: ["Sports Psychology", "Team Building", "Fitness Training"], availability: "weekends" },
            { name: "Dr. Maya Devi", expertise: ["Quantum Computing", "Advanced Algorithms", "Theoretical Physics"], availability: "flexible" },
        ];


        // Function to show custom modal
        function showCustomModal(message, type = 'alert', onConfirm = null) {
            modalMessage.textContent = message;
            modalActions.innerHTML = ''; // Clear previous buttons

            if (type === 'alert') {
                const okButton = document.createElement('button');
                okButton.textContent = 'OK';
                okButton.className = 'bg-blue-700 text-white px-4 py-2 rounded-md hover:bg-blue-800 transition duration-200';
                okButton.onclick = () => customModal.classList.remove('show');
                modalActions.appendChild(okButton);
            } else if (type === 'confirm') {
                const confirmButton = document.createElement('button');
                confirmButton.textContent = 'Confirm';
                confirmButton.className = 'bg-green-700 text-white px-4 py-2 rounded-md hover:bg-green-800 transition duration-200';
                confirmButton.onclick = () => {
                    customModal.classList.remove('show');
                    if (onConfirm) onConfirm();
                };
                const cancelButton = document.createElement('button');
                cancelButton.textContent = 'Cancel';
                cancelButton.className = 'bg-gray-700 text-white px-4 py-2 rounded-md hover:bg-gray-800 transition duration-200';
                cancelButton.onclick = () => customModal.classList.remove('show');
                modalActions.appendChild(confirmButton);
                modalActions.appendChild(cancelButton);
            }
            customModal.classList.add('show');
        }

        // Close modal when close button is clicked
        closeModalButton.onclick = () => customModal.classList.remove('show');

        // Close modal when clicking outside of the content
        window.onclick = (event) => {
            if (event.target == customModal) {
                customModal.classList.remove('show');
            }
        };

        // Conditional display for Venue input
        modeSelect.addEventListener('change', () => {
            if (modeSelect.value === 'Offline' || modeSelect.value === 'Hybrid') {
                venueGroup.classList.remove('hidden');
                venueInput.setAttribute('required', 'true');
            } else {
                venueGroup.classList.add('hidden');
                venueInput.removeAttribute('required');
                venueInput.value = ''; // Clear venue if not applicable
            }
        });

        // Autofill Venue (Mock Geolocation)
        autofillVenueBtn.addEventListener('click', () => {
            if (navigator.geolocation) {
                showCustomModal("Requesting your location to autofill nearest venues...", "alert");
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        // Mock data for nearest colleges/venues (using a cool-tone inspired naming)
                        const mockVenues = [
                            "Innovation Hub Auditorium",
                            "Aqua Tech Lecture Hall",
                            "Crystal Lake Convention Center",
                            "Emerald Gardens Amphitheater",
                            "Blue Sky Research Lab"
                        ];
                        const randomVenue = mockVenues[Math.floor(Math.random() * mockVenues.length)];
                        venueInput.value = randomVenue;
                        showCustomModal(`Location found! Autofilled: ${randomVenue}`, "alert");
                    },
                    (error) => {
                        console.error("Geolocation error:", error);
                        showCustomModal("Could not retrieve your location. Please enter venue manually.", "alert");
                    },
                    { enableHighAccuracy: true, timeout: 5000, maximumAge: 0 }
                );
            } else {
                showCustomModal("Geolocation is not supported by your browser. Please enter venue manually.", "alert");
            }
        });

        // Mock AI Generation Function
        async function generateEventPlan(formData) {
            // Simulate API call delay
            await new Promise(resolve => setTimeout(resolve, 2000));

            const { eventType, audience, theme, eventDate, duration, mode, venue, budgetLimit, customCommittees } = formData;

            // Deep copy staffData to track assignments for this plan
            let workingStaffData = JSON.parse(JSON.stringify(staffData));
            workingStaffData.forEach(s => s.currentAssignments = 0); // Initialize assignment counter

            // Function to get a unique professor and a specified number of volunteers
            function assignCommitteeMembers(committeeName, targetVolunteers, requiredSkills = [], departmentKeywords = []) {
                let assignedProfessor = null;
                let selectedVolunteers = [];
                let members = [];

                // 1. Prioritize Professor for lead, then ensure balanced assignment
                const availableProfessors = workingStaffData.filter(s =>
                    s.designation.includes('Professor') && s.currentAssignments < s.maxAssignments
                ).sort((a, b) => a.currentAssignments - b.currentAssignments); // Sort by fewest assignments

                if (availableProfessors.length > 0) {
                    // Try to match professor to department or skills
                    let bestProf = availableProfessors.find(prof =>
                        departmentKeywords.some(keyword => prof.department.toLowerCase().includes(keyword.toLowerCase())) ||
                        requiredSkills.some(skill => prof.skills.includes(skill))
                    );
                    if (!bestProf) {
                        bestProf = availableProfessors[0]; // Fallback to least assigned
                    }
                    assignedProfessor = bestProf;
                    assignedProfessor.currentAssignments++;
                    members.push(assignedProfessor.name);
                }


                // 2. Assign volunteers based on skills and availability
                let eligibleVolunteers = workingStaffData.filter(s =>
                    !s.designation.includes('Professor') && !members.includes(s.name) && s.currentAssignments < s.maxAssignments
                );

                // Sort eligible volunteers: 1. by matching skills, 2. by fewest assignments
                eligibleVolunteers.sort((a, b) => {
                    const aSkillMatch = requiredSkills.filter(skill => a.skills.includes(skill)).length;
                    const bSkillMatch = requiredSkills.filter(skill => b.skills.includes(skill)).length;

                    if (aSkillMatch !== bSkillMatch) {
                        return bSkillMatch - aSkillMatch; // More skill matches first
                    }
                    return a.currentAssignments - b.currentAssignments; // Then fewer assignments
                });

                for (let i = 0; i < targetVolunteers && eligibleVolunteers.length > 0; i++) {
                    const volunteer = eligibleVolunteers.shift(); // Take the best fit
                    selectedVolunteers.push(volunteer);
                    volunteer.currentAssignments++;
                    members.push(volunteer.name);
                }

                // If not enough volunteers found, try to include remaining staff
                if (selectedVolunteers.length < targetVolunteers) {
                    let remainingStaff = workingStaffData.filter(s =>
                        !members.includes(s.name) && s.currentAssignments < s.maxAssignments
                    ).sort((a, b) => a.currentAssignments - b.currentAssignments);

                    for (let i = 0; i < (targetVolunteers - selectedVolunteers.length) && remainingStaff.length > 0; i++) {
                        const staff = remainingStaff.shift();
                        selectedVolunteers.push(staff);
                        staff.currentAssignments++;
                        members.push(staff.name);
                    }
                }

                return {
                    professor: assignedProfessor ? assignedProfessor.name : "To Be Assigned",
                    members: members
                };
            }

            // --- Event Title & Description ---
            const eventTitle = `${theme} - ${eventType} ${eventDate.split('-')[0]}`;
            let eventDescription = `Get ready for the exciting "${eventTitle}"! This ${duration}-day ${eventType} is tailored for ${audience} at our esteemed university. Focusing on the captivating theme of "${theme}", we aim to provide a transformative experience.`;

            // --- Schedule Generation ---
            let schedule = [];
            const isFullDay = duration >= 0.8;
            const hasSpeakers = (eventType === "Seminar" || eventType === "Workshop" || eventType === "Conference" || eventType === "Webinar");

            const commonActivities = [
                { time: "09:00 AM - 09:30 AM", activity: "Registration & Welcome", speaker: "Event Team" },
                { time: "09:30 AM - 10:00 AM", activity: "Opening Ceremony", speaker: "University Dean/VC" },
                { time: "01:00 PM - 02:00 PM", activity: "Lunch Break", speaker: "" },
                { time: "05:00 PM - 05:30 PM", activity: "Closing Remarks & Vote of Thanks", speaker: "Head Coordinator" },
            ];

            if (hasSpeakers) {
                const availableSpeakers = [...speakerDatabase]; // Copy to avoid modifying original
                schedule.push(commonActivities[0]); // Registration
                schedule.push(commonActivities[1]); // Opening
                schedule.push({ time: "10:00 AM - 11:30 AM", activity: "Keynote Session", speaker: availableSpeakers.length > 0 ? availableSpeakers.shift().name : "Invited Expert" });
                schedule.push({ time: "11:30 AM - 01:00 PM", activity: `Interactive Session on ${theme}`, speaker: availableSpeakers.length > 0 ? availableSpeakers.shift().name : "Industry Leader" });
                schedule.push(commonActivities[2]); // Lunch
                schedule.push({ time: "02:00 PM - 03:30 PM", activity: "Panel Discussion / Hands-on Workshop", speaker: "Multiple Experts" });
                schedule.push({ time: "03:30 PM - 04:30 PM", activity: "Networking & Refreshments", speaker: "All Attendees" });
                schedule.push(commonActivities[3]); // Closing
            } else if (eventType === "Fest" || eventType === "Cultural Event") {
                schedule = [
                    { time: "09:00 AM - 10:00 AM", activity: "Event Inauguration & Flag Off", speaker: "Chief Guest" },
                    { time: "10:00 AM - 12:00 PM", activity: "Cultural Performances / Competitions", speaker: "Student Groups" },
                    { time: "12:00 PM - 01:00 PM", activity: "Interactive Stalls & Fun Activities", speaker: "Various Teams" },
                    { time: "01:00 PM - 02:00 PM", activity: "Lunch Break", speaker: "" },
                    { time: "02:00 PM - 04:00 PM", activity: "Main Stage Performances / Grand Competition", speaker: "Selected Acts" },
                    { time: "04:00 PM - 05:00 PM", activity: "Prize Distribution & Closing Ceremony", speaker: "Organizing Committee" },
                ];
            } else if (eventType === "Hackathon") {
                schedule = [
                    { time: "09:00 AM - 10:00 AM", activity: "Hackathon Briefing & Team Formation", speaker: "Event Organizers" },
                    { time: "10:00 AM - 01:00 PM", activity: "Coding Session (Phase 1)", speaker: "Participants" },
                    { time: "01:00 PM - 02:00 PM", activity: "Lunch Break", speaker: "" },
                    { time: "02:00 PM - 05:00 PM", activity: "Coding Session (Phase 2) & Mentoring", speaker: "Mentors" },
                    { time: "05:00 PM - 06:00 PM", activity: "Idea Submission & Initial Review", speaker: "Judges" },
                    // Overnight for multi-day hackathons
                ];
                if (duration > 1) {
                     schedule.push({ time: "Next Day 09:00 AM - 12:00 PM", activity: "Final Coding & Project Polishing", speaker: "Participants" });
                     schedule.push({ time: "12:00 PM - 01:00 PM", activity: "Project Presentations & Judging", speaker: "Teams & Judges" });
                     schedule.push({ time: "01:00 PM - 02:00 PM", activity: "Lunch Break", speaker: "" });
                     schedule.push({ time: "02:00 PM - 03:00 PM", activity: "Results Announcement & Awards", speaker: "Organizers" });
                }
            } else if (eventType === "Sports Event") {
                schedule = [
                    { time: "08:00 AM - 08:30 AM", activity: "Athlete Registration & Warm-up", speaker: "Sports Committee" },
                    { time: "08:30 AM - 09:00 AM", activity: "Opening Ceremony & Oath", speaker: "Sports Director" },
                    { time: "09:00 AM - 12:00 PM", activity: "Morning Matches/Competitions", speaker: "Referees" },
                    { time: "12:00 PM - 01:00 PM", activity: "Lunch Break", speaker: "" },
                    { time: "01:00 PM - 04:00 PM", activity: "Afternoon Matches/Finals", speaker: "Referees" },
                    { time: "04:00 PM - 05:00 PM", activity: "Prize Distribution & Closing Ceremony", speaker: "Chief Guest" },
                ];
            } else if (eventType === "Exhibition") {
                schedule = [
                    { time: "09:00 AM - 10:00 AM", activity: "Exhibition Opening & Ribbon Cutting", speaker: "University Dignitary" },
                    { time: "10:00 AM - 01:00 PM", activity: "Stall Visits & Demonstrations", speaker: "Exhibitors" },
                    { time: "01:00 PM - 02:00 PM", activity: "Lunch Break", speaker: "" },
                    { time: "02:00 PM - 04:00 PM", activity: "Interactive Sessions & Product Launches", speaker: "Companies/Innovators" },
                    { time: "04:00 PM - 05:00 PM", activity: "Audience Voting & Awards (if applicable)", speaker: "Organizing Committee" },
                ];
            }


            // --- Resource Suggestions ---
            let suggestedRooms = [];
            let suggestedEquipment = [];
            if (mode === 'Offline' || mode === 'Hybrid') {
                if (eventType === "Conference" || eventType === "Seminar" || eventType === "Webinar" || eventType === "Exhibition") {
                    suggestedRooms.push(availableRooms.find(r => r.name.includes("Auditorium") || r.name.includes("Conference Hall")) || availableRooms[0]);
                    suggestedEquipment.push(availableEquipment.find(e => e.name.includes("Projector")));
                    suggestedEquipment.push(availableEquipment.find(e => e.name.includes("Microphone")));
                    if (eventType === "Exhibition") {
                        suggestedEquipment.push(availableEquipment.find(e => e.name.includes("3D Printers")));
                    }
                } else if (eventType === "Hackathon" || eventType === "Workshop") {
                    suggestedRooms.push(availableRooms.find(r => r.name.includes("Computer Lab") || r.name.includes("Workshop")) || availableRooms[0]);
                    suggestedEquipment.push(availableEquipment.find(e => e.name.includes("Laptop")));
                    suggestedEquipment.push(availableEquipment.find(e => e.name.includes("Projector")));
                } else if (eventType === "Sports Event") {
                    suggestedRooms.push(availableRooms.find(r => r.name.includes("Sports Ground") || r.name.includes("Sports Complex")) || availableRooms[0]);
                    suggestedEquipment.push(availableEquipment.find(e => e.name.includes("Sound System")));
                    suggestedEquipment.push(availableEquipment.find(e => e.name.includes("First Aid Kits")));
                } else if (eventType === "Fest" || eventType === "Cultural Event") {
                    suggestedRooms.push(availableRooms.find(r => r.name.includes("Plaza") || r.name.includes("Auditorium")) || availableRooms[0]);
                    suggestedEquipment.push(availableEquipment.find(e => e.name.includes("Sound System")));
                    suggestedEquipment.push(availableEquipment.find(e => e.name.includes("Video Camera")));
                }
            } else { // Online mode
                eventDescription += ` The event will be conducted entirely online, leveraging virtual platforms to connect with our audience.`;
                suggestedRooms.push({ name: "Online Platform (e.g., Zoom, Google Meet, Microsoft Teams)", capacity: "N/A", features: ["Virtual Breakout Rooms", "Screen Sharing", "Recording"] });
                suggestedEquipment.push({ name: "Stable Internet Connection", type: "Connectivity", quantity: "N/A" });
                suggestedEquipment.push({ name: "Webcam & Headset", type: "Peripherals", quantity: "N/A" });
            }
            suggestedEquipment = suggestedEquipment.filter(Boolean).filter((v,i,a)=>a.findIndex(t=>(t.name === v.name))===i); // Remove duplicates


            // --- Speaker Suggestions (Enhanced) ---
            let suggestedSpeakers = [];
            if (hasSpeakers) {
                // Filter speakers by expertise related to the theme/event type
                const relevantSkills = [];
                if (theme.toLowerCase().includes("ai")) relevantSkills.push("AI", "Machine Learning", "Deep Learning", "Quantum Computing");
                if (theme.toLowerCase().includes("sustainable") || theme.toLowerCase().includes("climate")) relevantSkills.push("Sustainable Tech", "Environmental Policy", "Renewable Energy", "Climate Change");
                if (eventType.toLowerCase().includes("hackathon")) relevantSkills.push("Blockchain", "Startup Ecosystem");
                if (eventType.toLowerCase().includes("marketing")) relevantSkills.push("Digital Marketing", "Brand Building");
                if (eventType.toLowerCase().includes("sports")) relevantSkills.push("Sports Psychology", "Fitness Training");
                if (relevantSkills.length === 0) relevantSkills.push("Public Speaking"); // Default if no specific match

                const potentialSpeakers = speakerDatabase.filter(speaker =>
                    relevantSkills.some(skill => speaker.expertise.includes(skill))
                );

                if (potentialSpeakers.length > 0) {
                    suggestedSpeakers = potentialSpeakers.slice(0, Math.min(3, potentialSpeakers.length)); // Suggest up to 3
                } else {
                    suggestedSpeakers = speakerDatabase.slice(0, 2); // Fallback to general speakers
                }
            }


            // --- Poster Design Ideas ---
            const posterIdeas = [
                `A futuristic design with circuit board patterns and glowing lines, reflecting the "${theme}" theme.`,
                `Minimalist design focusing on the event title and key details, using the cool-tone palette.`,
                `Dynamic imagery related to ${eventType} with a subtle gradient overlay.`,
                `Illustration style: Abstract shapes and interconnected lines, emphasizing community and innovation.`
            ];

            // --- Social Media & Marketing Content ---
            const socialMediaCaption = ` Get ready for the ultimate ${eventType} experience! Join us for "${eventTitle}" on ${eventDate} (${duration} day(s)) at ${mode === 'Offline' ? (venue || 'our university campus') : 'our virtual platform'}! Explore the "${theme}" theme with ${audience}. Don't miss out! #UniversityEvent #${eventType.replace(/\s/g, '')} #${theme.replace(/\s/g, '')}`;
            const hashtags = `#${eventType.replace(/\s/g, '')} #${theme.replace(/\s/g, '')} #UniversityLife #Innovation #KnowledgeSharing #CampusEvent`;

            const emailDraft = `Subject: Invitation to "${eventTitle}"

Dear [Recipient Name],

We are thrilled to invite you to "${eventTitle}", a premier ${eventType} organized by [Your University Name]. This ${duration}-day event, focusing on the timely theme of "${theme}", is designed to enlighten and engage ${audience}.

Join us on ${eventDate} at ${mode === 'Offline' ? (venue || 'our university campus') : 'our virtual platform'} for insightful sessions, interactive workshops, and unparalleled networking opportunities.

[Link to Registration/More Info]

We look forward to your participation!

Sincerely,
The Organizing Committee
[Your University Name]`;

            const pressReleaseSnippet = `FOR IMMEDIATE RELEASE

[University Name] Announces Grand "${eventTitle}" Event

[City, State]  [Date]. [Your University Name] is proud to announce the upcoming "${eventTitle}", a landmark ${eventType} set to take place on ${eventDate}. The event will delve into the critical theme of "${theme}", bringing together leading experts and enthusiasts from various fields.

Aimed at ${audience}, this ${duration}-day gathering promises to be an immersive experience, fostering dialogue, innovation, and collaboration. Key highlights include [mention a schedule highlight, e.g., "interactive workshops," "keynote speeches from industry leaders," "competitive challenges"].

The event will be held ${mode === 'Offline' ? `at the ${venue || 'University campus'}` : 'online via a dedicated virtual platform'}. Registration is now open, and attendees are encouraged to secure their spots early.

### About [Your University Name]
[Brief university boilerplate]

Contact:
[Event Contact Name]
[Event Contact Email]`;


            // --- Committees & Staff Assignment ---
            let committees = {};
            let committeeList = [
                "Overall Coordination Committee",
                "Logistics & Venue Committee",
                "Technical & AV Committee",
                "Marketing & Publicity Committee",
                "Budget & Finance Committee",
                "Guest & Speaker Management Committee",
                "Student Volunteer Committee",
                "Catering & Hospitality Committee",
                "Security & First Aid Committee",
                // Add more specific committees based on event type
            ];

            // Add custom committees from user input
            if (customCommittees) {
                const userCommittees = customCommittees.split(',').map(c => c.trim()).filter(c => c);
                committeeList = [...new Set([...committeeList, ...userCommittees])]; // Add unique custom committees
            }


            committeeList.forEach(cName => {
                let assigned = null;
                switch (cName) {
                    case "Overall Coordination Committee":
                        assigned = assignCommitteeMembers(cName, 3, [], ["Administration", "Student Affairs"]);
                        break;
                    case "Logistics & Venue Committee":
                        assigned = assignCommitteeMembers(cName, 4, ["Logistics", "Operations", "Infrastructure Planning"], ["Administration", "Civil", "Mechanical"]);
                        break;
                    case "Technical & AV Committee":
                        assigned = assignCommitteeMembers(cName, 5, ["Networking", "Audio-Visual", "Technical Support", "Software Engineering"], ["C.S.E", "IT Support"]);
                        break;
                    case "Marketing & Publicity Committee":
                        assigned = assignCommitteeMembers(cName, 3, ["Digital Marketing", "Content Creation", "Public Relations", "Brand Management"], ["Marketing", "BBA"]);
                        break;
                    case "Budget & Finance Committee":
                        assigned = assignCommitteeMembers(cName, 2, ["Budgeting", "Expense Tracking", "Financial Reporting"], ["Finance", "BBA", "MBA"]);
                        break;
                    case "Guest & Speaker Management Committee":
                        assigned = assignCommitteeMembers(cName, 3, ["Guest Relations", "Protocol Management", "Communication"], ["Student Affairs", "MBA", "BBA"]);
                        break;
                    case "Student Volunteer Committee":
                        assigned = assignCommitteeMembers(cName, 5, ["Volunteer Management", "Student Engagement", "Team Building"], ["Student Affairs"]);
                        break;
                    case "Catering & Hospitality Committee":
                        assigned = assignCommitteeMembers(cName, 3, ["Menu Planning", "Hygiene Standards", "Logistics"], ["Food Services", "Administration"]);
                        break;
                    case "Security & First Aid Committee":
                        assigned = assignCommitteeMembers(cName, 4, ["Crowd Management", "Emergency Response", "Safety Protocols", "First Aid"], ["Security"]);
                        break;
                    default:
                        // For custom committees or others, assign randomly with a professor and 2-3 others
                        assigned = assignCommitteeMembers(cName, Math.floor(Math.random() * 2) + 2, [], []);
                        break;
                }
                committees[cName] = assigned;
            });


            // --- Budget Breakdown ---
            const totalBudget = parseFloat(budgetLimit);
            let budget = {};
            const budgetPercentages = {
                "Venue & Infrastructure": 0.20,
                "Marketing & Publicity": 0.15,
                "Speaker Fees & Travel": 0.25,
                "Catering & Hospitality": 0.15,
                "Equipment & AV Rental": 0.10,
                "Decorations & Ambiance": 0.05,
                "Contingency (10%)": 0.10
            };

            for (const category in budgetPercentages) {
                budget[category] = (totalBudget * budgetPercentages[category]).toFixed(2);
            }
            // Ensure total doesn't exceed budgetLimit due to rounding, adjust contingency
            let calculatedTotal = Object.values(budget).reduce((sum, val) => sum + parseFloat(val), 0);
            if (calculatedTotal > totalBudget) {
                const excess = calculatedTotal - totalBudget;
                budget["Contingency (10%)"] = (parseFloat(budget["Contingency (10%)"]) - excess).toFixed(2);
                if (parseFloat(budget["Contingency (10%)"]) < 0) budget["Contingency (10%)"] = "0.00"; // Prevent negative contingency
            }


            // --- Decoration Suggestions ---
            const decorationSuggestions = [
                "Utilize LED uplighting in cool tones (blues, greens) to create an immersive atmosphere.",
                "Incorporate themed props and backdrops related to '"+theme+"', such as abstract tech patterns for AI, or natural elements for sustainability.",
                "Use minimalist yet elegant stage decor with subtle branding.",
                "Consider interactive art installations or photo booths for audience engagement.",
                "For 'Fest' or 'Cultural Event': Bright, vibrant colors and traditional elements alongside modern lighting.",
                "For 'Sports Event': Banners with motivational quotes, team flags, and inflatable sports equipment."
            ];

            // --- Event Checklist (Expanded) ---
            const eventChecklist = [
                "Define Event Goals & Objectives",
                "Set Date, Time, and Duration",
                "Determine Event Mode (Online/Offline/Hybrid)",
                "Establish Budget Limit and Breakdown",
                "Formulate Event Theme and Audience Profile",
                "Identify Key Speakers/Guests and Confirm Availability",
                "Select and Book Venue/Platform & Necessary Resources (if Offline/Hybrid)",
                "Assign Committees and Staff Responsibilities",
                "Develop Detailed Event Schedule/Agenda",
                "Design and Finalize Event Branding (Logo, Posters, Banners)",
                "Create Marketing Strategy (Social Media, Email, Press Release)",
                "Prepare Registration System/Invitation Process",
                "Arrange for Catering & Hospitality",
                "Plan for Security, First Aid, and Emergency Protocols",
                "Finalize Equipment and AV requirements",
                "Recruit and Brief Volunteers",
                "Develop Contingency Plans for potential issues",
                "Conduct Pre-Event Technical Checks and Rehearsals",
                "Send out Final Reminders to Speakers, Staff, and Attendees",
                "Post-Event: Collect Feedback, Analyze Success, Send Thank You Notes",
                "Post-Event: Settle all Financials and Prepare Report",
            ];

            // --- Contingency Planning ---
            let contingencyPlan = `Despite meticulous planning, unforeseen circumstances can arise. Here are some contingency measures:
            * **Speaker Cancellation:** Have backup speakers or a panel discussion ready. Prepare alternative content like a Q&A session or a relevant video.
            * **Technical Glitches (Online/Hybrid):** Ensure a robust internet connection, backup power, and a dedicated technical support team. Have pre-recorded content for critical sessions.
            * **Lower Than Expected Attendance:** Implement last-minute marketing pushes, offer spot registrations, and engage attendees with interactive elements to enhance experience.
            * **Venue Issues (Offline/Hybrid):** Have an alternative nearby venue identified, or a flexible layout that can be adjusted.
            * **Budget Overruns:** Prioritize essential expenses, look for cost-saving alternatives, and be prepared to allocate from the contingency fund.
            * **Unfavorable Weather (Offline):** Plan for indoor alternatives or sheltered areas for outdoor activities.
            * **Medical Emergency:** Ensure readily available first aid, clear emergency exits, and contact details for nearest medical facilities.
            * **Crowd Control Issues:** Establish clear entry/exit points, sufficient security personnel, and communication protocols.`;


            currentPlanData = {
                eventTitle,
                eventDescription,
                schedule,
                posterIdeas,
                socialMediaCaption,
                hashtags,
                emailDraft,
                pressReleaseSnippet,
                committees,
                budget,
                decorationSuggestions,
                eventChecklist,
                contingencyPlan,
                sportsNames: eventType === "Sports Event" ? ["Champions Cup", "Athletic Zenith", "The Victory Sprint"] : [],
                sportsQuotes: eventType === "Sports Event" ? ["The harder the battle, the sweeter the victory.", "Push yourself because no one else is going to do it for you.", "Believe you can and youre halfway there."] : [],
                suggestedRooms,
                suggestedEquipment,
                suggestedSpeakers
            };

            return currentPlanData;
        }

        // Display Generated Plan
        function displayEventPlan(plan) {
            outputTitle.textContent = plan.eventTitle;
            outputDescription.textContent = plan.eventDescription;

            // Clear previous lists
            outputSchedule.innerHTML = '';
            outputPosterIdeas.innerHTML = '';
            outputCommittees.innerHTML = '';
            outputBudget.innerHTML = '';
            outputDecorations.innerHTML = '';
            outputChecklist.innerHTML = '';
            outputRooms.innerHTML = '';
            outputEquipment.innerHTML = '';
            outputSpeakers.innerHTML = '';
            outputSportsNames.innerHTML = '';
            outputSportsQuotes.innerHTML = '';

            // Schedule
            plan.schedule.forEach(item => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-200 hover:bg-gray-50';
                row.innerHTML = `
                    <td class="py-3 px-6 text-left">${item.time}</td>
                    <td class="py-3 px-6 text-left">${item.activity}</td>
                    <td class="py-3 px-6 text-left">${item.speaker || 'N/A'}</td>
                `;
                outputSchedule.appendChild(row);
            });

            // Poster Ideas
            plan.posterIdeas.forEach(idea => {
                const li = document.createElement('li');
                li.textContent = idea;
                outputPosterIdeas.appendChild(li);
            });

            // Social Media
            outputSocialMedia.textContent = plan.socialMediaCaption;
            outputHashtags.innerHTML = `<span class="text-blue-600">${plan.hashtags.split(' ').join('</span> <span class="text-blue-600">')}</span>`; // Add color to hashtags
            outputEmailDraft.textContent = plan.emailDraft;
            outputPressRelease.textContent = plan.pressReleaseSnippet;

            // Committees
            for (const committeeName in plan.committees) {
                const li = document.createElement('li');
                const prof = plan.committees[committeeName].professor;
                const members = plan.committees[committeeName].members.join(", ");
                li.innerHTML = `<strong>${committeeName}:</strong> Lead - ${prof}, Members: ${members}`;
                outputCommittees.appendChild(li);
            }

            // Budget
            for (const category in plan.budget) {
                const li = document.createElement('li');
                li.textContent = `${category}: ${plan.budget[category]}`;
                outputBudget.appendChild(li);
            }

            // Decorations
            plan.decorationSuggestions.forEach(suggestion => {
                const li = document.createElement('li');
                li.textContent = suggestion;
                outputDecorations.appendChild(li);
            });

            // Checklist
            plan.eventChecklist.forEach(item => {
                const li = document.createElement('li');
                li.innerHTML = `<i class="far fa-check-square text-green-500 mr-2"></i>${item}`;
                outputChecklist.appendChild(li);
            });

            // Contingency
            outputContingency.innerHTML = plan.contingencyPlan.split('*').map((item, index) => {
                if (index === 0) return item;
                return `<li class="ml-4">${item.trim()}</li>`;
            }).join('');


            // Letter
            outputLetter.textContent = plan.letterOfPermission || "Letter content will be generated here.";

            // Show/hide sports content
            if (plan.sportsNames.length > 0) {
                sportsContentDiv.classList.remove('hidden');
                plan.sportsNames.forEach(name => {
                    const li = document.createElement('li');
                    li.textContent = name;
                    outputSportsNames.appendChild(li);
                });
                plan.sportsQuotes.forEach(quote => {
                    const li = document.createElement('li');
                    li.textContent = quote;
                    outputSportsQuotes.appendChild(li);
                });
            } else {
                sportsContentDiv.classList.add('hidden');
            }

            // Display Rooms & Equipment
            if (plan.suggestedRooms.length > 0) {
                resourceContentDiv.classList.remove('hidden');
                plan.suggestedRooms.forEach(room => {
                    const li = document.createElement('li');
                    li.textContent = `${room.name} (Capacity: ${room.capacity}${room.capacity !== "N/A" ? ", Features: " + room.features.join(", ") : ""})`;
                    outputRooms.appendChild(li);
                });
            } else {
                 resourceContentDiv.classList.add('hidden');
            }
            if (plan.suggestedEquipment.length > 0) {
                resourceContentDiv.classList.remove('hidden'); // Ensure parent is visible
                plan.suggestedEquipment.forEach(eq => {
                    const li = document.createElement('li');
                    li.textContent = `${eq.name} (Type: ${eq.type}${eq.quantity !== "N/A" ? ", Quantity: " + eq.quantity : ""})`;
                    outputEquipment.appendChild(li);
                });
            }

            // Display Speakers
            if (plan.suggestedSpeakers.length > 0) {
                speakerContentDiv.classList.remove('hidden');
                plan.suggestedSpeakers.forEach(speaker => {
                    const li = document.createElement('li');
                    li.textContent = `${speaker.name} (Expertise: ${speaker.expertise.join(", ")})`;
                    outputSpeakers.appendChild(li);
                });
            } else {
                speakerContentDiv.classList.add('hidden');
            }
        }

        // Handle Form Submission
        eventForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            loadingSpinner.classList.remove('hidden');
            planOutput.classList.add('hidden');

            const formData = new FormData(eventForm);
            const data = Object.fromEntries(formData.entries());

            try {
                const plan = await generateEventPlan(data);
                displayEventPlan(plan);
                planOutput.classList.remove('hidden');
                // Scroll to output
                planOutput.scrollIntoView({ behavior: 'smooth', block: 'start' });
            } catch (error) {
                console.error("Error generating plan:", error);
                showCustomModal("An error occurred while generating the plan. Please try again.", "alert");
            } finally {
                loadingSpinner.classList.add('hidden');
            }
        });

        // Generate PDF
        downloadPdfBtn.addEventListener('click', () => {
            showCustomModal("Generating PDF...", "alert");
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            let yPos = 20;
            const margin = 10;
            const maxWidth = doc.internal.pageSize.width - 2 * margin;

            doc.setFontSize(22);
            doc.text(currentPlanData.eventTitle, margin, yPos);
            yPos += 10;
            doc.setFontSize(12);
            doc.text("University Event Plan", margin, yPos);
            yPos += 15;

            const addSection = (title, content, isList = false) => {
                if (!content || (isList && content.length === 0) || (!isList && content.trim() === '')) return;

                doc.setFontSize(16);
                doc.setTextColor(0, 150, 255); // Blue for headers
                doc.text(title, margin, yPos);
                yPos += 7;
                doc.setTextColor(0, 0, 0); // Black for text
                doc.setFontSize(11);

                if (isList) {
                    content.forEach(item => {
                        const lines = doc.splitTextToSize(` ${item}`, maxWidth);
                        doc.text(lines, margin + 5, yPos);
                        yPos += (lines.length * 5); // Line height
                    });
                } else if (typeof content === 'object') { // For committees and budget
                    for (const key in content) {
                        const lines = doc.splitTextToSize(`${key}: ${content[key]}`, maxWidth);
                        doc.text(lines, margin + 5, yPos);
                        yPos += (lines.length * 5);
                    }
                } else {
                    const lines = doc.splitTextToSize(content, maxWidth);
                    doc.text(lines, margin, yPos);
                    yPos += (lines.length * 5);
                }
                yPos += 10; // Space after section
            };

            addSection("Event Description", currentPlanData.eventDescription);
            addSection("Suggested Venues/Rooms", currentPlanData.suggestedRooms.map(r => `${r.name} (Capacity: ${r.capacity}, Features: ${r.features.join(", ")})`), true);
            addSection("Suggested Equipment", currentPlanData.suggestedEquipment.map(eq => `${eq.name} (Type: ${eq.type}, Quantity: ${eq.quantity})`), true);
            addSection("Suggested Speakers/Guests", currentPlanData.suggestedSpeakers.map(s => `${s.name} (Expertise: ${s.expertise.join(", ")})`), true);

            // Schedule table
            if (currentPlanData.schedule && currentPlanData.schedule.length > 0) {
                doc.setFontSize(16);
                doc.setTextColor(0, 150, 255);
                doc.text("Sample Schedule", margin, yPos);
                yPos += 7;
                doc.setTextColor(0, 0, 0);
                doc.setFontSize(10);

                const tableColumn = ["Time", "Activity", "Speaker/Performer"];
                const tableRows = currentPlanData.schedule.map(item => [item.time, item.activity, item.speaker || 'N/A']);

                doc.autoTable({
                    startY: yPos,
                    head: [tableColumn],
                    body: tableRows,
                    theme: 'grid',
                    styles: { fontSize: 9, cellPadding: 2, overflow: 'linebreak' },
                    headStyles: { fillColor: [0, 34, 51], textColor: [255, 255, 255], fontStyle: 'bold' },
                    bodyStyles: { fillColor: [240, 240, 240], textColor: [0, 0, 0] },
                    alternateRowStyles: { fillColor: [250, 250, 250] },
                    margin: { left: margin, right: margin }
                });
                yPos = doc.autoTable.previous.finalY + 10;
            }

            addSection("Poster Design Ideas", currentPlanData.posterIdeas, true);
            addSection("Social Media Caption", currentPlanData.socialMediaCaption);
            addSection("Hashtags", currentPlanData.hashtags);
            addSection("Email Draft", currentPlanData.emailDraft);
            addSection("Press Release Snippet", currentPlanData.pressReleaseSnippet);

            // Committees (complex object, handle specifically)
            if (currentPlanData.committees) {
                doc.setFontSize(16);
                doc.setTextColor(0, 150, 255);
                doc.text("Required Committees & Assigned Staff", margin, yPos);
                yPos += 7;
                doc.setTextColor(0, 0, 0);
                doc.setFontSize(11);
                for (const committeeName in currentPlanData.committees) {
                    const prof = currentPlanData.committees[committeeName].professor;
                    const members = currentPlanData.committees[committeeName].members.join(", ");
                    const text = ` ${committeeName}: Lead - ${prof}, Members: ${members}`;
                    const lines = doc.splitTextToSize(text, maxWidth);
                    doc.text(lines, margin + 5, yPos);
                    yPos += (lines.length * 5);
                }
                yPos += 10;
            }

            addSection("Budget Breakdown", currentPlanData.budget, false); // Pass as object, not list
            addSection("Decoration Suggestions", currentPlanData.decorationSuggestions, true);
            addSection("Event Planning Checklist", currentPlanData.eventChecklist, true);
            addSection("Contingency Planning", currentPlanData.contingencyPlan);

            // Letter of Permission
            doc.addPage();
            yPos = 20;
            doc.setFontSize(18);
            doc.setTextColor(0, 150, 255);
            doc.text("Letter of Permission", margin, yPos);
            yPos += 10;
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(11);
            const letterLines = doc.splitTextToSize(currentPlanData.letterOfPermission, maxWidth);
            doc.text(letterLines, margin, yPos);


            doc.save('EventPlan.pdf');
            customModal.classList.remove('show'); // Close modal
            showCustomModal("PDF generated successfully!", "alert");
        });


        // Edit Plan Button
        editPlanBtn.addEventListener('click', () => {
            showCustomModal("Are you sure you want to edit the plan? This will clear the current output and return to the form.", "confirm", () => {
                planOutput.classList.add('hidden');
                eventForm.reset();
                venueGroup.classList.add('hidden'); // Hide venue if mode isn't set
                venueInput.removeAttribute('required');
                document.getElementById('eventType').focus(); // Focus on first input
            });
        });

        // Start New Button
        startNewBtn.addEventListener('click', () => {
            showCustomModal("Are you sure you want to start a new plan? This will clear all current inputs and outputs.", "confirm", () => {
                planOutput.classList.add('hidden');
                eventForm.reset();
                venueGroup.classList.add('hidden'); // Hide venue if mode isn't set
                venueInput.removeAttribute('required');
                document.getElementById('eventType').focus(); // Focus on first input
            });
        });

        // Set initial letter content (can be overridden by AI)
        const generateLetter = (formData) => {
            const { eventType, theme, eventDate, duration, venue, mode, audience } = formData;
            const formattedDate = new Date(eventDate).toLocaleDateString('en-IN', {
                year: 'numeric', month: 'long', day: 'numeric'
            });
            const eventLocation = (mode === 'Offline' || mode === 'Hybrid') ? `at ${venue || 'the University Campus'}` : 'virtually via an online platform';

            return `[Your University Name/Department Letterhead]

[Date: ${new Date().toLocaleDateString('en-IN')}]

To,
The Dean/Registrar,
[Your University Name],
[University Address]

Subject: Request for Permission to Organize "${theme} - ${eventType} ${eventDate.split('-')[0]}"

Respected Sir/Madam,

We, the [Your Department/Club Name], are pleased to propose the organization of a **${eventType}** titled **"${theme} - ${eventType} ${eventDate.split('-')[0]}"**. This event is planned for **${formattedDate}**, spanning **${duration} day(s)**, and will be conducted **${eventLocation}**.

The primary objective of this ${eventType} is to [e.g., "enhance knowledge and skills in ${theme} for ${audience}", "foster cultural exchange among students", "promote healthy competition and sportsmanship"]. We anticipate participation from ${audience} and believe this event will significantly contribute to their academic and personal growth.

We have outlined a comprehensive plan covering all aspects, including:
1.  **Event Schedule:** [Briefly mention key activities, e.g., "keynote speeches, interactive workshops, and competitions"].
2.  **Target Audience:** ${audience}.
3.  **Resource Requirements:** We will require access to [mention general resources, e.g., "University Auditorium, sound systems, projectors, and IT support"].
4.  **Budget Estimate:** An estimated budget of INR ${parseFloat(formData.budgetLimit).toLocaleString('en-IN')} has been prepared to cover all expenditures.

We assure you that all necessary arrangements will be made to ensure the smooth and successful execution of the event, adhering to all university guidelines and protocols. We are committed to maintaining discipline and ensuring the safety of all participants.

We kindly request your esteemed permission and support to organize this event. We are available to discuss the detailed plan at your convenience.

Thanking you,

Sincerely,

[Your Name/Head of Organizing Committee]
[Your Designation/Department/Club]
[Contact Information]`;
        };
        // Initial letter generation on page load (or when data is available)
        eventForm.addEventListener('change', () => {
            const formData = new FormData(eventForm);
            const data = Object.fromEntries(formData.entries());
            // Only generate a preview if critical fields are filled
            if (data.eventType && data.theme && data.eventDate && data.duration && data.budgetLimit && data.audience && data.mode) {
                // currentPlanData.letterOfPermission = generateLetter(data); // This will be set inside generateEventPlan
            }
        });

        // Ensure jsPDF and html2canvas are loaded (for modern browsers, await for script loading)
        // For older browsers or local files, you might need a more robust loading mechanism.
        // This is a simple check to prevent immediate errors if libraries aren't ready.
        if (typeof window.jspdf === 'undefined' || typeof window.html2canvas === 'undefined') {
            console.warn("jsPDF or html2canvas not loaded. PDF download might not work.");
        }
    </script>
</body>
</html>
